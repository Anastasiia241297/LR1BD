-- Таблица авторов
CREATE TABLE author (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL
);

-- Таблица издательств
CREATE TABLE publisher (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL
);

-- Таблица книг
CREATE TABLE book (
    id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    publisher_id INT NOT NULL,
    publication_year INT NOT NULL,
    CONSTRAINT fk_publisher FOREIGN KEY (publisher_id) REFERENCES publisher(id) ON DELETE CASCADE
);

-- Промежуточная таблица для связи книг и авторов (многие-ко-многим)
CREATE TABLE book_author (
    book_id INT NOT NULL,
    author_id INT NOT NULL,
    PRIMARY KEY (book_id, author_id),
    CONSTRAINT fk_book FOREIGN KEY (book_id) REFERENCES book(id) ON DELETE CASCADE,
    CONSTRAINT fk_author FOREIGN KEY (author_id) REFERENCES author(id) ON DELETE CASCADE
);

-- Таблица экземпляров книг
CREATE TABLE book_instance (
    id SERIAL PRIMARY KEY,
    book_id INT NOT NULL,
    location VARCHAR(100) NOT NULL,
    CONSTRAINT fk_book_instance FOREIGN KEY (book_id) REFERENCES book(id) ON DELETE CASCADE
);

-- Таблица читателей
CREATE TABLE reader (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    birth_date DATE NOT NULL,
    gender CHAR(1) CHECK (gender IN ('M', 'F')),
    education_level VARCHAR(50) CHECK (education_level IN ('Среднее неполное', 'Среднее', 'Среднее специальное', 'Высшее'))
);

-- Таблица выдачи книг
CREATE TABLE book_issue (
    id SERIAL PRIMARY KEY,
    book_instance_id INT NOT NULL,
    reader_id INT NOT NULL,
    issue_date DATE NOT NULL,
    expected_return_date DATE NOT NULL,
    actual_return_date DATE,
    CONSTRAINT fk_book_instance FOREIGN KEY (book_instance_id) REFERENCES book_instance(id) ON DELETE CASCADE,
    CONSTRAINT fk_reader FOREIGN KEY (reader_id) REFERENCES reader(id) ON DELETE CASCADE
);

-- Добавление данных

-- Издательства
INSERT INTO publisher (name) VALUES
('Издательство 1'),
('Издательство 2'),
('Издательство 3');

-- Авторы
INSERT INTO author (first_name, last_name) VALUES
('Александр', 'Пушкин'),
('Лев', 'Толстой'),
('Фёдор', 'Достоевский'),
('Антон', 'Чехов'),
('Иван', 'Тургенев'),
('Джон', 'Толкин'),
('Джордж', 'Оруэлл'),
('Михаил', 'Булгаков'),
('Илья', 'Ильф'),
('Евгений', 'Петров');

-- Книги
INSERT INTO book (title, publisher_id, publication_year) VALUES
('Капитанская дочка', 1, 1836),
('Анна Каренина', 1, 1877),
('Братья Карамазовы', 2, 1880),
('Палата №6', 2, 1892),
('Рудин', 3, 1856),
('Хоббит', 3, 1937),
('Скотный двор', 3, 1945),
('Собачье сердце', 1, 1925),
('Необыкновенные истории', 2, 1927),
('Пиковая дама', 1, 1834),
('Севастопольские рассказы', 1, 1855),
('Белые ночи', 2, 1848),
('Три сестры', 2, 1901),
('Дворянское гнездо', 3, 1859),
('Сильмариллион', 3, 1977),
('Дорога на причал', 3, 1943),
('Театральный роман', 1, 1936),
('Заметки сатирика', 2, 1932),
('Арап Петра Великого', 1, 1837),
('Казаки', 1, 1863),
('Идиот', 2, 1869),
('Дама с собачкой', 2, 1899),
('Вешние воды', 3, 1872),
('Письма профессора Толкина', 3, 1981),
('Эссе на тему', 3, 1941),
('Роковые яйца', 1, 1924),
('Звезда', 2, 1929),
('Руслан и Людмила', 1, 1820),
('Утро помещика', 1, 1856),
('Игрок', 2, 1867);

-- Связь книг и авторов
INSERT INTO book_author (book_id, author_id) VALUES
(1, 1),
(2, 2),
(3, 3),
(4, 4),
(5, 5),
(6, 6),
(7, 7),
(8, 8),
(9, 9),
(9, 10),
(10, 9),
(10, 10),
(11, 1),
(12, 2),
(13, 3),
(14, 4),
(15, 5),
(16, 6),
(17, 7),
(18, 8),
(19, 9),
(19, 10),
(20, 1),
(21, 2),
(22, 3),
(23, 4),
(24, 5),
(25, 6),
(26, 7),
(27, 8),
(28, 9),
(28, 10),
(29, 1),
(30, 2);

INSERT INTO book_instance (book_id, location)
SELECT id, 'Секция ' || s
FROM book CROSS JOIN generate_series(1, 4) AS s;

-- Читатели
INSERT INTO reader (first_name, last_name, birth_date, gender, education_level) VALUES
('Иван', 'Иванов', '1990-01-01', 'M', 'Высшее'),
('Анна', 'Смирнова', '1985-05-20', 'F', 'Среднее'),
('Олег', 'Петров', '1992-09-13', 'M', 'Среднее специальное'),
('Мария', 'Кузнецова', '1995-08-10', 'F', 'Высшее'),
('Григорьев', 'Роман', '1987-06-20', 'M', 'Среднее специальное'),
('Павлова', 'Ольга', '1991-04-10', 'F', 'Среднее'),
('Смирнов', 'Константин', '1996-01-18', 'M', 'Высшее'),
('Голубев', 'Игорь', '1984-08-23', 'M', 'Среднее'),
('Орлова', 'Татьяна', '1981-02-10', 'F', 'Среднее специальное'),
('Гаврилов', 'Андрей', '1989-05-05', 'M', 'Высшее'),
('Федорова', 'Марина', '1982-10-14', 'F', 'Среднее'),
('Шевченко', 'Юлия', '1997-08-22', 'F', 'Среднее'),
('Чернов', 'Максим', '1983-03-19', 'M', 'Среднее специальное'),
('Захарова', 'Нина', '1994-07-30', 'F', 'Высшее'),
('Боброва', 'Ирина', '1980-09-09', 'F', 'Высшее'),
('Рыбаков', 'Александр', '1986-11-12', 'M', 'Среднее'),
('Жукова', 'Светлана', '1995-02-25', 'F', 'Среднее'),
('Козлов', 'Юрий', '1990-04-14', 'M', 'Среднее'),
('Тимофеева', 'Алина', '1992-03-29', 'F', 'Высшее'),
('Щербакова', 'Евгения', '1988-09-04', 'F', 'Среднее неполное'),
('Захаров', 'Олег', '1994-12-16', 'M', 'Высшее'),
('Маркова', 'Наталья', '1993-01-11', 'F', 'Среднее'),
('Дмитриева', 'Ксения', '1987-04-23', 'F', 'Среднее'),
('Ковалев', 'Вячеслав', '1995-10-30', 'M', 'Среднее специальное'),
('Карпов', 'Максим', '1991-06-05', 'M', 'Высшее'),
('Белова', 'Анна', '1986-07-18', 'F', 'Среднее'),
('Романов', 'Дмитрий', '1982-03-03', 'M', 'Среднее специальное'),
('Морозова', 'Татьяна', '1990-09-27', 'F', 'Высшее'),
('Тарасов', 'Виктор', '1984-11-16', 'M', 'Среднее'),
('Савченко', 'Юлия', '1992-05-15', 'F', 'Среднее специальное'),
('Чистов', 'Александр', '1993-08-02', 'M', 'Высшее'),
('Андреев', 'Петр', '1988-12-09', 'M', 'Среднее'),
('Кириллова', 'Инна', '1989-07-22', 'F', 'Среднее'),
('Смирнова', 'Екатерина', '1996-06-01', 'F', 'Среднее специальное'),
('Васильев', 'Игорь', '1987-04-01', 'M', 'Высшее'),
('Шевцова', 'Анна', '1992-01-29', 'F', 'Среднее'),
('Шаповалова', 'Марина', '1991-09-06', 'F', 'Среднее неполное'),
('Гончарова', 'Надежда', '1993-11-17', 'F', 'Высшее'),
('Семёнова', 'Ирина', '1985-12-14', 'F', 'Среднее'),
('Лебедев', 'Валерий', '1990-10-25', 'M', 'Среднее'),
('Григорьева', 'Светлана', '1988-08-13', 'F', 'Высшее'),
('Николаев', 'Анатолий', '1994-05-12', 'M', 'Среднее'),
('Жданова', 'Екатерина', '1989-02-18', 'F', 'Среднее специальное'),
('Лазарев', 'Никита', '1996-11-23', 'M', 'Высшее'),
('Беляева', 'Виктория', '1991-07-09', 'F', 'Среднее'),
('Пономарев', 'Артем', '1995-03-02', 'M', 'Среднее'),
('Филипова', 'Маргарита', '1990-04-22', 'F', 'Среднее специальное'),
('Глеб', 'Матвеев', '1987-03-19', 'M', 'Высшее'),
('Вера', 'Семенова', '1991-10-12', 'F', 'Среднее'),
('Алексей', 'Романов', '1994-08-08', 'M', 'Среднее неполное'),
('Татьяна', 'Воронцова', '1989-12-02', 'F', 'Высшее'),
('Юрий', 'Климов', '1990-05-17', 'M', 'Среднее'),
('Дарья', 'Соловьева', '1996-11-30', 'F', 'Среднее'),
('Николай', 'Федоров', '1985-07-15', 'M', 'Высшее'),
('Оксана', 'Михайлова', '1993-04-19', 'F', 'Среднее специальное'),
('Евгений', 'Гусев', '1992-02-13', 'M', 'Высшее'),
('Елена', 'Терентьева', '1988-06-14', 'F', 'Среднее'),
('Кирилл', 'Никитин', '1991-01-23', 'M', 'Среднее специальное'),
('Алла', 'Лукина', '1990-09-18', 'F', 'Среднее'),
('Игорь', 'Ермаков', '1987-11-04', 'M', 'Высшее'),
('София', 'Калинина', '1994-10-26', 'F', 'Среднее специальное'),
('Владислав', 'Трофимов', '1995-01-05', 'M', 'Среднее'),
('Лидия', 'Морозова', '1984-02-21', 'F', 'Высшее'),
('Анатолий', 'Рябов', '1993-03-27', 'M', 'Среднее специальное'),
('Мария', 'Гордеева', '1986-12-08', 'F', 'Среднее'),
('Даниил', 'Шаров', '1992-07-16', 'M', 'Среднее'),
('Екатерина', 'Зимина', '1990-09-25', 'F', 'Среднее специальное'),
('Максим', 'Соколов', '1994-06-30', 'M', 'Высшее'),
('Анна', 'Голикова', '1995-11-22', 'F', 'Среднее'),
('Сергей', 'Зайцев', '1988-04-20', 'M', 'Среднее'),
('Юлия', 'Крылова', '1996-07-11', 'F', 'Среднее специальное'),
('Павел', 'Малышев', '1990-08-07', 'M', 'Среднее'),
('Людмила', 'Шестакова', '1989-12-29', 'F', 'Высшее'),
('Виталий', 'Кожевников', '1993-02-16', 'M', 'Среднее специальное'),
('Наталья', 'Миронова', '1992-05-24', 'F', 'Среднее'),
('Роман', 'Кузьмин', '1986-09-12', 'M', 'Высшее'),
('Евгения', 'Киселева', '1985-11-10', 'F', 'Среднее специальное'),
('Артем', 'Чернышов', '1991-03-06', 'M', 'Среднее'),
('Ольга', 'Голубева', '1994-10-15', 'F', 'Среднее'),
('Дмитрий', 'Павлов', '1987-06-13', 'M', 'Среднее специальное'),
('Инна', 'Кравцова', '1995-04-30', 'F', 'Высшее'),
('Станислав', 'Яковлев', '1989-01-03', 'M', 'Среднее'),
('Лилия', 'Тихонова', '1990-02-14', 'F', 'Среднее специальное'),
('Владимир', 'Ильин', '1992-08-01', 'M', 'Среднее'),
('Елена', 'Быкова', '1993-07-19', 'F', 'Среднее'),
('Михаил', 'Коновалов', '1984-05-22', 'M', 'Высшее'),
('Виктор', 'Потапов', '1986-03-22', 'M', 'Высшее'),
('Маргарита', 'Савельева', '1991-10-01', 'F', 'Среднее специальное'),
('Андрей', 'Панфилов', '1988-07-07', 'M', 'Среднее'),
('Светлана', 'Рожкова', '1992-01-17', 'F', 'Среднее'),
('Георгий', 'Поляков', '1994-11-11', 'M', 'Среднее специальное'),
('Елизавета', 'Гончарова', '1989-05-08', 'F', 'Высшее'),
('Олег', 'Рыбников', '1990-02-28', 'M', 'Среднее'),
('Дарья', 'Кузьмина', '1993-04-21', 'F', 'Среднее специальное'),
('Иван', 'Селиванов', '1995-06-06', 'M', 'Высшее'),
('Антонина', 'Кудрявцева', '1987-09-14', 'F', 'Среднее'),
('Денис', 'Прохоров', '1996-08-25', 'M', 'Среднее'),
('Полина', 'Горина', '1985-03-19', 'F', 'Среднее специальное'),
('Сергей', 'Титов', '1991-12-04', 'M', 'Высшее'),
('Алина', 'Шаповал', '1988-06-15', 'F', 'Среднее специальное'),
('Григорий', 'Баженов', '1984-10-19', 'M', 'Среднее'),
('Дмитрий', 'Сидоров', '1988-12-25', 'M', 'Среднее');

INSERT INTO book_issue (book_instance_id, reader_id, issue_date, expected_return_date, actual_return_date) VALUES
(1, 1, '2024-02-01', '2024-02-15', '2024-02-15'),
(2, 2, '2024-02-02', '2024-02-16', '2024-02-16'),
(3, 3, '2024-02-03', '2024-02-17', '2024-02-16'),
(4, 4, '2024-02-04', '2024-02-18', '2024-02-16'),
(5, 5, '2024-02-05', '2024-02-19', '2024-02-16'),
(6, 6, '2024-02-06', '2024-02-20', '2024-02-20'),
(7, 7, '2024-02-07', '2024-02-21', '2024-02-21'),
(8, 8, '2024-02-08', '2024-02-22', '2024-02-20'),
(9, 9, '2024-02-09', '2024-02-23', '2024-02-20'),
(10, 10, '2024-02-10', '2024-02-24', '2024-02-20'),
(11, 11, '2024-02-11', '2024-02-25', '2024-02-20'),
(12, 12, '2024-02-12', '2024-02-26', '2024-02-26'),
(13, 13, '2024-02-13', '2024-02-27', '2024-02-27'),
(14, 14, '2024-02-14', '2024-02-28', '2024-02-27'),
(15, 15, '2024-02-15', '2024-02-29', '2024-02-27'),
(16, 16, '2024-02-16', '2024-03-01', '2024-02-27'),
(17, 17, '2024-02-17', '2024-03-02', '2024-03-02'),
(18, 18, '2024-02-18', '2024-03-03', '2024-03-02'),
(19, 19, '2024-02-19', '2024-03-04', '2024-03-02'),
(20, 20, '2024-02-20', '2024-03-05', '2024-03-02'),
(21, 21, '2024-02-21', '2024-03-06', '2024-03-02'),
(22, 22, '2024-02-22', '2024-03-07', '2024-03-02'),
(23, 23, '2024-02-23', '2024-03-08', '2024-03-02'),
(24, 24, '2024-02-24', '2024-03-09', '2024-03-09'),
(25, 25, '2024-02-25', '2024-03-10', '2024-03-10'),
(26, 26, '2024-02-26', '2024-03-11', '2024-03-10'),
(27, 27, '2024-02-27', '2024-03-12', '2024-03-12'),
(28, 28, '2024-02-28', '2024-03-13', '2024-03-10'),
(29, 29, '2024-02-29', '2024-03-14', '2024-03-10'),
(30, 30, '2024-03-01', '2024-03-15', '2024-03-15'),
(31, 1, '2024-03-02', '2024-03-16', '2024-03-15'),
(32, 2, '2024-03-03', '2024-03-17', '2024-03-15'),
(33, 3, '2024-03-04', '2024-03-18', '2024-03-15'),
(34, 4, '2024-03-05', '2024-03-19', '2024-03-15'),
(35, 5, '2024-03-06', '2024-03-20', '2024-03-15'),
(36, 6, '2024-03-07', '2024-03-21', '2024-03-15'),
(37, 7, '2024-03-08', '2024-03-22', '2024-03-22'),
(38, 8, '2024-03-09', '2024-03-23', '2024-03-23'),
(39, 9, '2024-03-10', '2024-03-24', '2024-03-23'),
(40, 10, '2024-03-11', '2024-03-25', '2024-03-23'),
(41, 11, '2024-03-12', '2024-03-26', '2024-03-23'),
(42, 12, '2024-03-13', '2024-03-27', '2024-03-27'),
(43, 13, '2024-03-14', '2024-03-28', '2024-03-23'),
(44, 14, '2024-03-15', '2024-03-29', '2024-03-23'),
(45, 15, '2024-03-16', '2024-03-30', '2024-03-23'),
(46, 16, '2024-03-17', '2024-03-31', '2024-03-31'),
(47, 17, '2024-03-18', '2024-04-01', '2024-04-01'),
(48, 18, '2024-03-19', '2024-04-02', '2024-04-01'),
(49, 19, '2024-03-20', '2024-04-03', '2024-04-01'),
(50, 20, '2024-03-21', '2024-04-04', '2024-04-01'),
(51, 21, '2024-03-22', '2024-04-05', '2024-04-01'),
(52, 22, '2024-03-23', '2024-04-06', '2024-04-01'),
(53, 23, '2024-03-24', '2024-04-07', '2024-04-01'),
(54, 24, '2024-03-25', '2024-04-08', '2024-04-08'),
(55, 25, '2024-03-26', '2024-04-09', '2024-04-01'),
(56, 26, '2024-03-27', '2024-04-10', '2024-04-01'),
(57, 27, '2024-03-28', '2024-04-11', '2024-04-11'),
(58, 28, '2024-03-29', '2024-04-12', '2024-04-12'),
(59, 29, '2024-03-30', '2024-04-13', '2024-04-12'),
(60, 30, '2024-03-31', '2024-04-14', '2024-04-12'),
(61, 1, '2024-04-01', '2024-04-15', '2024-04-12'),
(62, 2, '2024-04-02', '2024-04-16', '2024-04-12'),
(63, 3, '2024-04-03', '2024-04-17', '2024-04-12'),
(64, 4, '2024-04-04', '2024-04-18', '2024-04-12'),
(65, 5, '2024-04-05', '2024-04-19', '2024-04-19'),
(66, 6, '2024-04-06', '2024-04-20', '2024-04-12'),
(67, 7, '2024-04-07', '2024-04-21', '2024-04-12'),
(68, 8, '2024-04-08', '2024-04-22', '2024-04-22'),
(69, 9, '2024-04-09', '2024-04-23', '2024-04-23'),
(70, 10, '2024-04-10', '2024-04-24', '2024-04-23'),
(71, 11, '2024-04-11', '2024-04-25', '2024-04-23'),
(72, 12, '2024-04-12', '2024-04-26', '2024-04-23'),
(73, 13, '2024-04-13', '2024-04-27', '2024-04-23'),
(74, 14, '2024-04-14', '2024-04-28', '2024-04-23'),
(75, 15, '2024-04-15', '2024-04-29', '2024-04-29'),
(76, 16, '2024-04-16', '2024-04-30', '2024-04-30'),
(77, 17, '2024-04-17', '2024-05-01', '2024-05-01'),
(78, 18, '2024-04-18', '2024-05-02', '2024-05-02'),
(79, 19, '2024-04-19', '2024-05-03', '2024-05-02'),
(80, 20, '2024-04-20', '2024-05-04', '2024-05-02'),
(81, 21, '2024-04-21', '2024-05-05', '2024-05-02'),
(82, 22, '2024-04-22', '2024-05-06', '2024-05-02'),
(83, 23, '2024-04-23', '2024-05-07', '2024-05-07'),
(84, 24, '2024-04-24', '2024-05-08', '2024-05-07'),
(85, 25, '2024-04-25', '2024-05-09', '2024-05-07'),
(86, 26, '2024-04-26', '2024-05-10', '2024-05-07'),
(87, 27, '2024-04-27', '2024-05-11', '2024-05-07'),
(88, 28, '2024-04-28', '2024-05-12', '2024-05-12'),
(89, 29, '2024-04-29', '2024-05-13', '2024-05-13'),
(90, 30, '2024-04-30', '2024-05-14', '2024-05-13'),
(91, 1, '2024-05-01', '2024-05-15', '2024-05-13'),
(92, 2, '2024-05-02', '2024-05-16', '2024-05-13'),
(93, 3, '2024-05-03', '2024-05-17', '2024-05-17'),
(94, 4, '2024-05-04', '2024-05-18', '2024-05-18'),
(95, 5, '2024-05-05', '2024-05-19', '2024-05-19'),
(96, 6, '2024-05-06', '2024-05-20', '2024-05-20'),
(97, 7, '2024-05-07', '2024-05-21', '2024-05-20'),
(98, 8, '2024-05-08', '2024-05-22', '2024-05-20'),
(99, 9, '2024-05-09', '2024-05-23', '2024-05-20'),
(100, 10, '2024-05-10', '2024-05-24', '2024-05-20'),
(101, 11, '2024-05-11', '2024-05-25', '2024-05-20'),
(102, 12, '2024-05-12', '2024-05-26', '2024-05-26');